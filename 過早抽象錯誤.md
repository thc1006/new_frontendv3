# æ ¹æ“š SUPERVISOR_NOTES.mdï¼Œä½ çŠ¯äº† Premature Abstractionï¼ˆéæ—©æŠ½è±¡ï¼‰ éŒ¯èª¤çš„åœ°æ–¹æ˜¯ï¼š

**å…·é«”éŒ¯èª¤ï¼šcreate_error_message() å‡½æ•¸**

ä½ åœ¨ 6 å€‹æ¨¡çµ„ä¸­éƒ½å»ºç«‹äº†é¡ä¼¼çš„ create_error_message() å‡½æ•¸ï¼š

## âŒ éæ—©æŠ½è±¡çš„éŒ¯èª¤åšæ³•

```python
def create_error_message(lang_code: str):
    """Create an error message."""
    from linebot.v3.messaging import TextMessage
    from src.modules.xxx.constants import RESPONSE_DATA_PATH
    from src.modules.utils import get_response

    return TextMessage(
        quickReply=None,
        quoteToken=None,
        text=get_response(RESPONSE_DATA_PATH, "error_message", lang_code),
    )
```

### ç‚ºä»€éº¼é€™æ˜¯éæ—©æŠ½è±¡ï¼Ÿ

1. å‡½æ•¸å¤ªç°¡å–®ï¼šåªæœ‰ä¸€è¡Œ return èªå¥
2. æ²’æœ‰å¯¦è³ªæŠ½è±¡åƒ¹å€¼ï¼šåªæ˜¯å–®ç´”åŒ…è£äº† compose_text_message()
3. å¢åŠ ä¸å¿…è¦çš„å±¤ç´šï¼šå¤šäº†ä¸€å±¤å‡½æ•¸èª¿ç”¨ï¼Œå»æ²’æœ‰æä¾›é¡å¤–åƒ¹å€¼
4. è·¨ 6 å€‹æ¨¡çµ„é‡è¤‡ï¼šåœ¨çœŸæ­£éœ€è¦ä¹‹å‰å°±é å…ˆå»ºç«‹äº†é€™å€‹æŠ½è±¡

## âœ… æ­£ç¢ºåšæ³•ï¼šç›´æ¥ä½¿ç”¨

```python
# åœ¨ handler çš„ except å¡Šä¸­ç›´æ¥ä½¿ç”¨
except Exception as e:
    logger.exception(f"Error in qna_handler: {e}")
    return compose_text_message(
        get_response(RESPONSE_DATA_PATH, "error_message", lang_code)
    )
```

---

## ä¸»ç®¡çš„åŸè©±

"ç°¡å–®åˆ°åªæœ‰ä¸€å€‹ return compose_text_message() çš„äº‹æƒ…å°±ä¸è¦å¤šå¯«ä¸€å€‹ function äº†ï¼Œç›´æ¥å¯«åœ¨ handler è£¡é¢å°±å¥½"

é€™å¥è©±ç›´æ¥é»å‡ºäº†å•é¡Œæ ¸å¿ƒï¼š

* å¦‚æœå‡½æ•¸é«”åªæœ‰ä¸€è¡Œ return
* è€Œä¸”åªæ˜¯å‘¼å«å¦ä¸€å€‹å·²å­˜åœ¨çš„å‡½æ•¸
* é‚£å°±ä¸éœ€è¦å†åŒ…è£ä¸€å±¤

---

## éæ—©æŠ½è±¡çš„åˆ¤æ–·æ¨™æº–

æ ¹æ“šé€™å€‹æ¡ˆä¾‹ï¼Œå¯ä»¥ç¸½çµå‡ºä»¥ä¸‹åˆ¤æ–·æ¨™æº–ï¼š

### ğŸš« é€™äº›æƒ…æ³æ˜¯éæ—©æŠ½è±¡ï¼š

1. å‡½æ•¸åªæœ‰ 1-2 è¡Œï¼Œè€Œä¸”åªæ˜¯ç°¡å–®åŒ…è£
2. åªç”¨åˆ° 1-2 æ¬¡ï¼Œé‚„æ²’åˆ°ã€Œé‡è¤‡ã€çš„ç¨‹åº¦
3. æ²’æœ‰æ¥­å‹™é‚è¼¯ï¼Œåªæ˜¯ç´”ç²¹çš„è½‰ç™¼
4. å‘½åæ²’æœ‰å¢åŠ èªæ„ï¼Œä¸æ¯”ç›´æ¥èª¿ç”¨æ›´æ¸…æ¥š

### âœ… é€™äº›æƒ…æ³æ‰éœ€è¦æŠ½è±¡ï¼š

1. è‡³å°‘é‡è¤‡ 3 æ¬¡ä»¥ä¸Šï¼ˆRule of Threeï¼‰
2. åŒ…å«è¤‡é›œé‚è¼¯ï¼Œå€¼å¾—å°è£
3. æä¾›æ˜ç¢ºçš„èªæ„ï¼Œè®“ä»£ç¢¼æ›´æ˜“è®€
4. éš±è—å¯¦ä½œç´°ç¯€ï¼Œæä¾›ç©©å®šä»‹é¢

---

## å¯¦éš›å°æ¯”

è®“æˆ‘å€‘çœ‹çœ‹ä½ çš„ç¨‹å¼ç¢¼ï¼š

**å¾ src/modules/qna/**init**.py çš„ä¿®æ”¹**

### ä¿®æ”¹å‰ï¼ˆéæ—©æŠ½è±¡ï¼‰ï¼š

```python
def create_error_message(lang_code: str):  # ä¸å¿…è¦çš„æŠ½è±¡
    return compose_text_message(
        get_response(RESPONSE_DATA_PATH, "error_message", lang_code)
    )

def qna_handler(lang_code: str, params: Optional[Dict]):
    try:
        # ...
    except Exception as e:
        logger.exception(f"Error in qna_handler: {e}")
        return create_error_message(lang_code)  # å¤šäº†ä¸€å±¤èª¿ç”¨
```

### ä¿®æ”¹å¾Œï¼ˆç›´æ¥ä½¿ç”¨ï¼‰ï¼š

```python
def qna_handler(lang_code: str, params: Optional[Dict]):
    try:
        # ...
    except Exception as e:
        logger.exception(f"Error in qna_handler: {e}")
        return compose_text_message(  # ç›´æ¥ä½¿ç”¨ï¼Œæ›´æ¸…æ¥š
            get_response(RESPONSE_DATA_PATH, "error_message", lang_code)
        )
```

---

## é—œéµæ´å¯Ÿ

é€™å€‹éŒ¯èª¤å¾ˆå¸¸è¦‹ï¼Œå°¤å…¶æ˜¯åœ¨ï¼š

1. AI ç”Ÿæˆä»£ç¢¼æ™‚ï¼šAI å‚¾å‘æ–¼ã€Œé é˜²æ€§åœ°ã€å»ºç«‹æŠ½è±¡
2. éåº¦è¨­è¨ˆæ™‚ï¼šæƒ³è‘—ã€Œæœªä¾†å¯èƒ½éœ€è¦ã€
3. æ¨¡ä»¿æ¨¡å¼æ™‚ï¼šçœ‹åˆ°å…¶ä»–åœ°æ–¹æœ‰é¡ä¼¼å‡½æ•¸ï¼Œå°±ä¹Ÿå»ºç«‹ä¸€å€‹

---

## æ­£ç¢ºå¿ƒæ…‹

ç­‰åˆ°çœŸæ­£éœ€è¦æ™‚å†æŠ½è±¡ï¼š

* ç¬¬ 1 æ¬¡å‡ºç¾ï¼šç›´æ¥å¯«
* ç¬¬ 2 æ¬¡å‡ºç¾ï¼šè¤‡è£½è²¼ä¸Šï¼ˆæš«æ™‚å¿å—é‡è¤‡ï¼‰
* ç¬¬ 3 æ¬¡å‡ºç¾ï¼šè€ƒæ…®æŠ½è±¡
* ç¬¬ 4 æ¬¡å‡ºç¾ï¼šå¿…é ˆæŠ½è±¡

é€™å°±æ˜¯ Rule of Three çš„å¯¦è¸ã€‚

---

ç°¡å–®ä¾†èªªï¼Œä½ çš„ create_error_message() å‡½æ•¸å°±æ˜¯å…¸å‹çš„éæ—©æŠ½è±¡æ¡ˆä¾‹ï¼šåœ¨é‚„æ²’æœ‰çœŸæ­£é‡è¤‡éœ€æ±‚æ™‚ï¼Œå°±é å…ˆå»ºç«‹äº†æŠ½è±¡å±¤ï¼Œåè€Œå¢åŠ äº†ä»£ç¢¼è¤‡é›œåº¦è€Œæ²’æœ‰å¸¶ä¾†å¯¦è³ªå¥½è™•ã€‚
